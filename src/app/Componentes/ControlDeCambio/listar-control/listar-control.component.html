<section class="app-container " >
       <header>
           <mat-toolbar color="primary" class="hi">
              Listado de Controles de Cambio
           </mat-toolbar>
       </header>
</section>
<mat-grid-list cols="4" rowHeight="70px">
  <mat-grid-tile
      [colspan]="2"
      [rowspan]="1"
      >
     <mat-form-field>
    <!--(keyup)="applyFilter($event.target.value)" evento para el filtro-->
      <input matInput 
                name="buscador"
                  ngModel
                  
                  [(ngModel)]="buscador"
                  (keyup)="applyFilter($event.target.value)" 
                  placeholder="Buscar ...">
  </mat-form-field>
  </mat-grid-tile>
  <mat-grid-tile
      [colspan]="1"
      [rowspan]="1"
      class="selector"
      >
    <mat-form-field>
    <mat-label>Buscar por prioridad</mat-label>
    <mat-select>
     <mat-option *ngFor="let estado of estados" [value]="estado.value" (click)="mostrarInputs(estado, $event.target.value)">
        {{estado.viewValue}}
      </mat-option>
    </mat-select> 
  </mat-form-field>
  </mat-grid-tile>
  <mat-grid-tile
      [colspan]="1"
      [rowspan]="1"
    class="btnPlus"
      >
    <a mat-mini-fab color="primary"
          matTooltip="Solicitar Control de Cambio"
            matTooltipPosition="above"
            aria-label="Button that displays a tooltip in various positions"
            class="agregar"
            [routerLink]="['/Home/SolicitarControlDeCambios']"><mat-icon mat-list-icon>add</mat-icon>
       </a>
  
  <button 
  mat-mini-fab 
  color="primary"
  matTooltip="Crear reporte"
  matTooltipPosition="above"
  aria-label="Button that displays a tooltip in various positions"
  class="agregar"
  (click) = " ExportExcel()"
  ><mat-icon mat-list-icon>trending_down</mat-icon></button>
  </mat-grid-tile>
</mat-grid-list>

<div  class="mat-elevation-z4 tablita">
<table mat-table
       [dataSource]="dataSource" multiTemplateDataRows>
<!-- ID Column -->
    <ng-container matColumnDef="Id_Control_Cambio">
      <th mat-header-cell *matHeaderCellDef class="header">ID</th>
      <td mat-cell *matCellDef="let element"> {{element.Id_Control_Cambio}} </td>
    </ng-container>
<!-- Nombre Column -->
    <ng-container matColumnDef="Nombre_Control_Cambio">
      <th mat-header-cell *matHeaderCellDef class="header">Nombre</th>
      <td mat-cell *matCellDef="let element"> {{element.Nombre_Control_Cambio}} </td>
    </ng-container>
<!-- Estatus_Control_Cambio Column -->
    <ng-container matColumnDef="Estatus_Control_Cambio">
      <th mat-header-cell *matHeaderCellDef class="header">Estatus</th>
      <td mat-cell *matCellDef="let element"> {{element.Estado}} </td>
    </ng-container>
<!-- Fecha_Solicitud Column -->
    <ng-container matColumnDef="Fecha_Solicitud">
      <th mat-header-cell *matHeaderCellDef class="header">Fecha de solicitud </th>
      <td mat-cell *matCellDef="let element"> {{element.Fecha_Solicitud}} </td>
    </ng-container>
<!-- Prioridad_CC Column -->
    <ng-container matColumnDef="Prioridad_CC">
      <th mat-header-cell *matHeaderCellDef class="header">Nivel Prioridad</th>
      <td mat-cell *matCellDef="let element"> {{element.Prioridad}} </td>
    </ng-container>
<!-- Prioridad_CC Column -->
    <ng-container matColumnDef="Id_servicio">
      <th mat-header-cell *matHeaderCellDef class="header">Servicio</th>
      <td mat-cell *matCellDef="let element"> {{element.Servicio}} </td>
    </ng-container>
<!-- Opciones Column -->
    <ng-container matColumnDef="Opciones">
      <th mat-header-cell *matHeaderCellDef class="header">Opciones</th>
      <td mat-cell *matCellDef="let element" >


<!--Actualizar Planificados
 <a  *ngIf = "element.Estatus_Control_Cambio == 4 && usuario.Id_Rol_Usuario <= 4" mat-mini-fab color="accent" [routerLink]="['/Home/ActualizarPlanificacion', element.Id_Control_Cambio]" style="color:white"
         matTooltip="Editar Planificacion"
         matTooltipPosition="above"
         aria-label="Button that displays a tooltip in various positions">
        <mat-icon mat-list-icon>edit</mat-icon>
        </a>-->
       
<!--Para Borradores-->
        <a  *ngIf = "(element.Estatus_Control_Cambio == 1 && usuario.Id_Rol_Usuario < 4) || (element.Estatus_Control_Cambio == 1 && usuario.Id_Usuario == element.Id_solicitante)" mat-mini-fab color="accent" [routerLink]="['/Home/ActualizarBorrador', element.Id_Control_Cambio]" style="color:white"
         matTooltip="Actualizar Borrador"
         matTooltipPosition="above"
         aria-label="Button that displays a tooltip in various positions">
        <mat-icon mat-list-icon>edit</mat-icon>
        </a>
<!--Para Evaluar (Tengo ganas de colocar un modal quese eocupe de eso)-->
        <a  *ngIf = "element.Estatus_Control_Cambio == 1 && usuario.Id_Rol_Usuario <= 3" mat-mini-fab color="accent"  style="color:white"
         (click) = "ClickEvaluar(element.Id_Control_Cambio, usuario.Id_Usuario)"
         matTooltip="Evaluar Borrador"
         matTooltipPosition="above"
         aria-label="Button that displays a tooltip in various positions">
        <mat-icon mat-list-icon>sync_alt</mat-icon>
        </a>
<!--Para Aprobados-->
        <a  *ngIf = "element.Estatus_Control_Cambio == 3 && usuario.Id_Rol_Usuario <= 3" mat-mini-fab color="accent" [routerLink]="['/Home/PlanificarControlDeCambio/', element.Id_Control_Cambio]" style="color:white"
         matTooltip="Planificar Control de Cambio"
         matTooltipPosition="above"
         aria-label="Button that displays a tooltip in various positions">
        <mat-icon mat-list-icon>class</mat-icon>
        </a>
<!--Para Planificados  matTooltip="Ejecutar Control de Cambio"
         matTooltipPosition="above"
         aria-label="Button that displays a tooltip in various positions">
        <mat-icon mat-list-icon>double_arrow</mat-icon>
{{element.responsable.Id_Usuario}}
      -->

        <a  *ngIf = "(element.Estatus_Control_Cambio == 4 && usuario.Id_Rol_Usuario <= 3) || (element.Estatus_Control_Cambio == 4 && usuario.Id_Rol_Usuario == element.responsable.Id_Usuario)" mat-mini-fab color="accent" [routerLink]="['/Home/ListarTareas/ControlCambio/', element.Id_Control_Cambio]" style="color:white"
         matTooltip="Administrar Tareas"
         click= "$event.stopPropagation"
         matTooltipPosition="above"
         aria-label="Button that displays a tooltip in various positions">
        <mat-icon mat-list-icon>post_add</mat-icon>
        </a> 
        <!--Listado Personal-->
        <a  *ngIf = "element.Estatus_Control_Cambio == 4 " mat-mini-fab color="accent" [routerLink]="['/Home/ListarTareasPersonal/ControlCambio/', usuario.Id_Usuario,element.Id_Control_Cambio]" style="color:red"
         matTooltip="Listado de Tareas Personales"
         click= "$event.stopPropagation"
         matTooltipPosition="above"
         aria-label="Button that displays a tooltip in various positions">
        <mat-icon mat-list-icon>post_add</mat-icon>
        </a>
<!--Para espera de ejecucion-->
        <a  *ngIf = "element.Estatus_Control_Cambio == 5 && usuario.Id_Rol_Usuario <= 3" mat-mini-fab color="accent" style="color:white"
        (click) ="ClickEjecutar(element.Id_Control_Cambio)"
         matTooltip="Ejecutar plan de control de cambio"
         matTooltipPosition="above"
         aria-label="Button that displays a tooltip in various positions">
        <mat-icon mat-list-icon>double_arrow</mat-icon>
        </a>
<!--Para Ejecucion-->
        <a  *ngIf = "element.Estatus_Control_Cambio == 6 && usuario.Id_Rol_Usuario <= 3" mat-mini-fab color="accent" style="color:white"
         (click) = "ClickFinalizar(element.Id_Control_Cambio, usuario.Id_Usuario)"
         matTooltip="Terminar control de cambios"
         matTooltipPosition="above"
         aria-label="Button that displays a tooltip in various positions">
        <mat-icon mat-list-icon>check</mat-icon>
        </a>
<!--Para Terminados
<a mat-mini-fab color="accent" *ngIf = "element.Estatus_Control_Cambio == 7"
          matTooltip="Observar informacion"
          [routerLink]="['/Home/PlanificarControlDeCambio/', element.Id_Control_Cambio]"
          style="color:white"
          matTooltip="Ver informacion"
          matTooltipPosition="above"
          aria-label="Button that displays a tooltip in various positions">
            <mat-icon mat-list-icon>zoom_in</mat-icon>
        </a>
-->
        

  




      </td>
    </ng-container>
  <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
  <ng-container matColumnDef="expandedDetail">
    <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length" >
      <div class="example-element-detail "
           [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
      

<mat-grid-list cols="7" rowHeight="120px">
  <mat-grid-tile
      [colspan]="4"
      [rowspan]="3"
      [style.background]="lightblue">
    <mat-list >
       <mat-list-item *ngIf = "element.Id_administrador; else Nobtn" class="mb"> Administrador:  {{element.administrador.Nombre_Usuario}}({{element.administrador.Correo_Usuario}})<mat-icon mat-list-icon>supervised_element_circle</mat-icon>  </mat-list-item>
       <mat-list-item *ngIf = "element.Id_administrador == null" #Nobtn> Administrador:  No indicado<mat-icon mat-list-icon>supervised_element_circle</mat-icon>  </mat-list-item>

       <mat-list-item *ngIf = "element.Id_responsable; else Nobtn"> Responsable:  {{element.responsable.Nombre_Usuario}} ({{element.responsable.Correo_Usuario}})<mat-icon mat-list-icon>supervised_element_circle</mat-icon>  </mat-list-item>
       <mat-list-item *ngIf = "element.Id_responsable == null " #Nobtn> Responsable:  No indicado<mat-icon mat-list-icon>supervised_element_circle</mat-icon>  </mat-list-item>

       <mat-list-item *ngIf = "element.Id_solicitante; else Nobtn"> Solicitante:  {{element.solicitante.Nombre_Usuario}} ({{element.solicitante.Correo_Usuario}})<mat-icon mat-list-icon>supervised_element_circle</mat-icon>  </mat-list-item>
       <mat-list-item *ngIf = "element.Id_solicitante  == null" #Nobtn> Solicitante:  No indicado<mat-icon mat-list-icon>supervised_element_circle</mat-icon>  </mat-list-item>

       <mat-list-item *ngIf = "element.Id_verificador; else Nobtn"> Verificador:  {{element.verificador.Nombre_Usuario}} ({{element.verificador.Correo_Usuario}})<mat-icon mat-list-icon>supervised_element_circle</mat-icon>  </mat-list-item>
       <mat-list-item *ngIf = "element.Id_verificador == null" #Nobtn> Verificador:  No indicado<mat-icon mat-list-icon>supervised_element_circle</mat-icon>  </mat-list-item>

       <mat-list-item *ngIf = "element.Id_evaluador; else Nobtn"> Evaluador:  {{element.evaluador.Nombre_Usuario}} ({{element.evaluador.Correo_Usuario}})<mat-icon mat-list-icon>supervised_element_circle</mat-icon>  </mat-list-item>
       <mat-list-item *ngIf = "element.Id_evaluador == null" #Nobtn> Evaluador:  No indicado<mat-icon mat-list-icon>supervised_element_circle</mat-icon>  </mat-list-item>
<!--
       <mat-list-item *ngIf = "element.Id_verificador; else Nobtn"> Verificador:  {{element.verificador.Nombre_Usuario}} ({{element.verificador.Correo_Usuario}})<mat-icon mat-list-icon>supervised_element_circle</mat-icon>  </mat-list-item>
       <mat-list-item *ngIf = "!element.Id_solicitante" #Nobtn> Verificador:  No indicado<mat-icon mat-list-icon>supervised_element_circle</mat-icon>  </mat-list-item>

       <mat-list-item *ngIf = "element.Id_evaluador; else Nobtn"> Evaluador:  {{element.evaluador.Nombre_Usuario}} ({{element.evaluador.Correo_Usuario}})<mat-icon mat-list-icon>supervised_element_circle</mat-icon>  </mat-list-item>
       <mat-list-item *ngIf = "!element.Id_solicitante" #Nobtn> Evaluador:  No indicado<mat-icon mat-list-icon>supervised_element_circle</mat-icon>  </mat-list-item>
-->
      
    </mat-list>
  </mat-grid-tile>  
  <mat-grid-tile
      [colspan]="3"
      [rowspan]="3"
      [style.background]="lightblue">
     <mat-list>
       <mat-list-item> {{element.Descripcion_Control_Cambio}} </mat-list-item>
      </mat-list>
  </mat-grid-tile>
</mat-grid-list>



      </div>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="columnsToDisplay" class="encabezado"></tr>
  <tr mat-row *matRowDef="let element; columns: columnsToDisplay;"
      class="example-element-row"
      [class.example-expanded-row]="expandedElement === element"
      >
      <!--(click)="expandedElement = expandedElement === element ? null : element"-->
  </tr>
  <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row "></tr>
</table> 
<mat-paginator class="paginacion"[pageSizeOptions]="[3, 5]" showFirstLastButtons></mat-paginator>
</div>
